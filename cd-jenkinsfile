pipeline{
    agent any
    environment {
        TODAY = sh(script: "date +%Y-%m-%d_%H-%M-%S", returnStdout: true).trim()
    }
    
    parameters{
        string(name:'GITHUB_BRANCH',description:'Provid the branch name to implement CD')
        string(name: 'CI_WORKSPACE', description: 'Provide the workspace path of the CI job')
    }
    
    stages{
        stage('notification'){
            steps{
                script{
                    sh "echo ${params.GITHUB_BRANCH}"
                    sh "echo ${params.CI_WORKSPACE}"
                    if("${params.GITHUB_BRANCH}" == "master")
                    {
                        echo "master branch"
                    }
                    else if(params.GITHUB_BRANCH.startsWith("release"))
                    {
                        echo "release branch"
                        withCredentials([[$class: 'UsernamePasswordMultiBinding', credentialsId: 'gogularaja-azure-git', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD']])
                        {
                            sh '''
                                cd /var/lib/jenkins/workspace/local-git/release/
                                cp -R ${params.CI_WORKSPACE}/* .
                                git config user.email "gogularaja.sr@gmail.com"
                                git config user.name "gogularaja"
                                git add .
                                git commit -m "new change $dt"
                                git push https://$USERNAME:$PASSWORD@nodejs-app1.scm.azurewebsites.net:443/nodejs-app1.git
                            '''
                        }
                    }
                    else if("${params.GITHUB_BRANCH}" == "develop")
                    {
                        echo "develop branch"
                    }
                    else
                    {
                        echo "required branch does not exists"
                    }
                }
            }        
        }
    }
}
